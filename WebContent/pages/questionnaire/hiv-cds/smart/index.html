<!DOCTYPE html>

<html lang="en">

	<head>
		<!-- title -->
		<title>SMART on FHIR Example Application (index.html)</title>

		<!-- links -->
		<link rel="shortcut icon" type="image/x-icon" href="/lforms-examples/img/nachc-favico.png">
		<link rel="icon" href="/lforms-examples/img/nachc-favico.png">
		<link href="/lforms-examples/lib/lforms-30.0.0/webcomponent/styles.css" media="screen" rel="stylesheet" />

		<!-- javascript libraries -->
		<script src='/lforms-examples/lib/smart/fhir-client-v0.1.12.js'></script>
		<script src='/lforms-examples/lib/smart/fhir-client-cerner-additions-1.0.0.js'></script>
		<script src='/lforms-examples/lib/jquery-1.11.3/jquery.min.js'></script>

	</head>

	<body>
		<h1>CDS HIV Questionnaire</h1>

		<script src="/lforms-examples/lib/lforms-30.0.0/webcomponent/assets/lib/zone.min.js"></script>
		<script src="/lforms-examples/lib/lforms-30.0.0/webcomponent/scripts.js"></script>
		<script src="/lforms-examples/lib/lforms-30.0.0/webcomponent/runtime-es5.js"></script>
		<script src="/lforms-examples/lib/lforms-30.0.0/webcomponent/polyfills-es5.js"></script>
		<script src="/lforms-examples/lib/lforms-30.0.0/webcomponent/main-es5.js"></script> 
		<script src="https://clinicaltables.nlm.nih.gov/lforms-versions/30.0.0/fhir/R4/lformsFHIR.min.js"></script>
		
		<div id="questionnaire-NACHCA0"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCA0.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCA0');});</script>
		<br/>
		<div id="questionnaire-NACHCA1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCA1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCA1');});</script>
		<br/>
		<div id="questionnaire-NACHCA2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCA2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCA2');});</script>
		<br/>
		<div id="questionnaire-NACHCB1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCB1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCB1');});</script>
		<br/>
		<div id="questionnaire-NACHCB2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCB2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCB2');});</script>
		<br/>
		<div id="questionnaire-NACHCC1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCC1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCC1');});</script>
		<br/>
		<div id="questionnaire-NACHCC2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCC2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCC2');});</script>
		<br/>
		<div id="questionnaire-NACHCD1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCD1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCD1');});</script>
		<br/>
		<div id="questionnaire-NACHCD2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCD2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCD2');});</script>
		<br/>
		<div id="questionnaire-NACHCE1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCE1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCE1');});</script>
		<br/>
		<div id="questionnaire-NACHCE2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCE2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCE2');});</script>
		<br/>
		<div id="questionnaire-NACHCF1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCF1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCF1');});</script>
		<br/>
		<div id="questionnaire-NACHCF2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCF2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCF2');});</script>
		<br/>
		<div id="questionnaire-NACHCG1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCG1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCG1');});</script>
		<br/>
		<div id="questionnaire-NACHCG2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCG2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCG2');});</script>
		<br/>
		<div id="questionnaire-NACHCH1"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCH1.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCH1');});</script>
		<br/>
		<div id="questionnaire-NACHCH2"></div>
		<script>$.get("/lforms-examples/questionnaire/hiv-cds/questionnaire-NACHCH2.json", function(data) {LForms.Util.addFormToPage(data, 'questionnaire-NACHCH2');});</script>
		<br/>



		<p>
			<br/><br/>
			------------------------------------------------------------------------------
		</p>
		<div id="patientSuccessMsg"></div>
		<br/>

		<!-- text area for patient raw data -->
		<h3>Patient Raw Data</h3>
		<p>
			<textarea class="scrollable" id="patientJson"></textarea>
		</p>
		<br/>

		<!-- text area for smart object as json -->
		<h3>Javascript object: smart</h3>
		<p>
			<textarea class="scrollable" id="smartJson"></textarea>
		</p>
		<h3>Patient</h3>
		<table border="2">
			<tr>
				<td>First&nbsp;Name:&nbsp;</td>
				<td id="fname">Not Available</td>
			</tr>
			<tr>
				<td>Last&nbsp;Name:&nbsp;</td>
				<td id="lname">Not Available</td>
			</tr>
			<tr>
				<td>Gender:&nbsp;</td>
				<td id="gender">Not Available</td>
			</tr>
			<tr>
				<td>Date&nbsp;Of&nbsp;Birth:&nbsp;</td>
				<td id="dob">Not Available</td>
			</tr>
		</table>
		
		<script>
			fhirOnReady = function(smart) {
		        patient = smart.patient;
		       	pt = patient.read();
		       	
		        var obv = smart.patient.api.fetchAll({
	                type: 'Observation',
	                query: {
	                  code: {
	                    $or: [
	                      'http://loinc.org|8302-2', 
	                      'http://loinc.org|8462-4',
	                      'http://loinc.org|8480-6', 
	                      'http://loinc.org|2085-9',
	                      'http://loinc.org|2089-1', 
	                      'http://loinc.org|55284-4'
	                    ]
	                  }
	                }
	              });

		        var populatePatientData = function(patient) {
		        	$("#fname").html(patient.name[0].given);
		        	$("#lname").html(patient.name[0].family);
		        	$("#gender").html(patient.gender);
		        	$("#dob").html(patient.birthDate);
		        }
		        
			    $.when(pt, obv).fail(fhirOnError);
			
			    $.when(pt, obv).done(
			        function(patient, obv) {
			        	populatePatientData(patient);
			        	$("#patientJson").html(JSON.stringify(patient,undefined,2));
			        	$("#patientSuccessMsg").html("<h1>Congratulations, you've also successfully loaded a patient using SMART on FHIR</h1>");
			        	$("#smartJson").html(JSON.stringify(smart,undefined,2));
			    	}
			    );

			};

			fhirOnError = function() {
	        	$("#patientJson").html("An error occurred.\nThis is expected if you are looking at this page from a browser.");
	        	$("#smartJson").html("An error occurred.\nThis is expected if you are looking at this page from a browser.");
			};
			
		    FHIR.oauth2.ready(fhirOnReady, fhirOnError);

		</script>

	</body>

</html>

